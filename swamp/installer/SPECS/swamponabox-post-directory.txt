echo "post directory"
if [ -r /etc/.mysql_root ]
then
    dbroot=`openssl enc -d -aes-256-cbc -in /etc/.mysql_root  -pass pass:swamp`
    echo '[client]' > /opt/swamp/sql/sql.cnf
    # Chmod ASAP
    chmod 400 /opt/swamp/sql/sql.cnf
    echo password=$dbroot >> /opt/swamp/sql/sql.cnf
    echo user=root >> /opt/swamp/sql/sql.cnf
    opt=--defaults-file=/opt/swamp/sql/sql.cnf
	# install
	if [ "$1" == "1" ]
	then
		echo "directory install"
    # upgrade
    elif [ "$1" == "2" ] 
    then
		echo "start mysql"
		service mysql start
		echo "directory upgrade"
        if [ -r /opt/swamp/sql/upgrades_directory/upgrade_script.sql ]
        then
            echo 'Running SQL upgrade script(s) against database...'
            cd /opt/swamp/sql/upgrades_directory
            mysql $opt < upgrade_script.sql
        fi
    	echo "stored procedures"
    	mysql $opt < /opt/swamp/sql/project_procs.sql 
		echo "stop mysql"
		service mysql stop
    fi
    /bin/rm -f /opt/swamp/sql/sql.cnf
else
    echo Unable to infer the password to mysql, unable to run scripts.
fi
